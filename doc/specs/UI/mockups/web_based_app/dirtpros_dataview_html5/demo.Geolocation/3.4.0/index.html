<html>

<head>

<title>Geolocation</title>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript" charset="utf-8" src="http://localhost:58888/_appMobi/appmobi.js"></script>

<script type="text/javascript">

    var tmrSplash;
    tmrSplash=setTimeout("document.getElementById('splash').style.display='none';document.getElementById('splash').style.top='1024px';",3000);

    var _map = null;
    var _seconds = 30;
	var _llbounds = null;

	var boolTripTrack=true;  //use this flag to continually update the GPS location and leave markers every 30 seconds

    function initialize()
    { }

    function drawMap()
    {
        var latlng = new google.maps.LatLng(currentLatitude,currentLongitude);
        var mapOptions = {
            zoom:10,
            center: latlng,
            mapTypeId: google.maps.MapTypeId.HYBRID,
			zoomControl: true,
            zoomControlOptions: {
              style: google.maps.ZoomControlStyle.SMALL,
			  position: google.maps.ControlPosition.LEFT_TOP
            },
        };

        if (boolTripTrack==true)
        {
            _map = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);
        }
    }

    //40.7655,-73.97204 = NYC
    var currentLatitude = "40.713768";
    var currentLongitude = "-73.016696";
    var options = {
					 timeout: 10000,
					 maximumAge: 11000,
					 enableHighAccuracy: true
				  };

	var suc = function(p){
		console.log("geolocation success",4);

		if( _map == null ) {
			currentLatitude = p.coords.latitude;
			currentLongitude = p.coords.longitude;
			drawMap();
		}

	  	var myLatLng = new google.maps.LatLng(p.coords.latitude, p.coords.longitude);
	  	var beachMarker = new google.maps.Marker({
		  position: myLatLng,
		  map: _map
		});

		if( _llbounds == null )
			_llbounds = new google.maps.LatLngBounds(new google.maps.LatLng(p.coords.latitude, p.coords.longitude));
		else
			_llbounds.extend(new google.maps.LatLng(p.coords.latitude, p.coords.longitude));
		_map.fitBounds(_llbounds);
	};

	var fail = function(){
		console.log("Geolocation failed. \nPlease enable GPS in Settings.",1);
	};

    var getLocation = function()
    {
        console.log("in getLocation",4);
    }

    //AppMobi is ready to roll
    function onDeviceReady()
    {
        try
        {
            if (AppMobi.device.platform.indexOf("Android")!=-1)
            {
                AppMobi.display.useViewport(480,480);
                document.getElementById("map_canvas").style.width="480px";
            }
            else if (AppMobi.device.platform.indexOf("iOS")!=-1)
            {
                if (AppMobi.device.model.indexOf("iPhone")!=-1 || AppMobi.device.model.indexOf("iPod")!=-1)
                {
                    AppMobi.display.useViewport(320,320);
                    document.getElementById("map_canvas").style.width="320px";
                }
                else if (AppMobi.device.model.indexOf("iPad")!=-1)
                {
                    AppMobi.display.useViewport(768,768);
                    document.getElementById("map_canvas").style.width="768px";
                }
            }

			if (AppMobi.geolocation != null)
			{
				AppMobi.geolocation.watchPosition(suc,fail,options);
			}
        }
        catch(e)
        {
            alert(e.message);
        }

        try
        {
            //lock orientation
            AppMobi.device.setRotateOrientation("portrait");
            AppMobi.device.setAutoRotate(false);
        }
        catch(e) {}

        try
        {
            //manage power
            AppMobi.device.managePower(true,false);
        }
        catch(e) {}
		
		try
		{
			//hide splash screen
			AppMobi.device.hideSplashScreen();
        }
        catch(e) {}		
    }

    //initial event handler to detect when appMobi is ready to roll
    document.addEventListener("appMobi.device.ready",onDeviceReady,false);

</script>
</script>
</head>
<body style="font-family:Arial;font-size:18pt;border:0;margin:0;padding:0;">
<div id="map_canvas" style="width:320px;height:100%;text-align:center;"><h1>Determining Your Location</h1></div>
</body>
</html>